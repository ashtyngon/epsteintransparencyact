---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import PersonCard from '../../components/PersonCard.astro';
import { getCollection } from 'astro:content';

const people = (await getCollection('people'))
  .sort((a, b) => a.data.name.localeCompare(b.data.name));

const categoryOrder = ['named-in-documents', 'witness', 'associate', 'official', 'legal', 'victim-survivor', 'other'];
const categories = categoryOrder.filter((cat) => people.some((p) => p.data.category === cat));

const categoryLabels: Record<string, string> = {
  'named-in-documents': 'Named in Documents',
  witness: 'Witnesses',
  associate: 'Associates',
  official: 'Officials',
  legal: 'Legal',
  'victim-survivor': 'Victims & Survivors',
  other: 'Other',
};
---

<BaseLayout
  title="People Named in the Epstein Files — Full Database"
  description="Searchable database of individuals named in the Epstein Files — politicians, billionaires, royals, academics, and officials. Each profile cross-referenced with DOJ documents and news coverage."
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
    <Breadcrumbs items={[{ name: 'People', href: '/people' }]} />

    <div class="mb-8">
      <h1 class="text-3xl md:text-4xl font-serif font-bold text-primary mb-2">People Named in the Epstein Files</h1>
      <p class="text-sm text-text-muted max-w-2xl">
        Every individual named in the Epstein Files — politicians, billionaires, royals, academics, and officials. Each profile cross-referenced with DOJ documents and news coverage. Inclusion does not imply guilt or wrongdoing.
      </p>
    </div>

    {people.length > 0 ? (
      <div class="space-y-10">
        {categories.map((cat) => {
          const categoryPeople = people.filter((p) => p.data.category === cat);
          return categoryPeople.length > 0 ? (
            <section>
              <div class="flex items-center justify-between mb-4 border-b-2 border-primary pb-2">
                <h2 class="text-sm font-semibold uppercase tracking-wider text-primary">
                  {categoryLabels[cat] || cat}
                </h2>
                <span class="text-xs text-text-muted font-mono">{categoryPeople.length}</span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {categoryPeople.map((person) => (
                  <PersonCard person={person} />
                ))}
              </div>
            </section>
          ) : null;
        })}
      </div>
    ) : (
      <div class="text-center py-20">
        <p class="text-text-muted font-serif text-lg">People database is being built.</p>
      </div>
    )}
  </div>
</BaseLayout>
