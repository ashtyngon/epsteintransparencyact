---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import PersonCard from '../../components/PersonCard.astro';
import { getCollection } from 'astro:content';

const people = (await getCollection('people'))
  .sort((a, b) => a.data.name.localeCompare(b.data.name));

const categories = [...new Set(people.map((p) => p.data.category))];

const categoryLabels: Record<string, string> = {
  'named-in-documents': 'Named in Documents',
  witness: 'Witnesses',
  associate: 'Associates',
  official: 'Officials',
  legal: 'Legal',
  'victim-survivor': 'Victims/Survivors',
  other: 'Other',
};
---

<BaseLayout
  title="People"
  description="A database of individuals connected to the Epstein case â€” named in documents, officials, associates, witnesses, and survivors."
>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <Breadcrumbs items={[{ name: 'People', href: '/people' }]} />

    <h1 class="text-3xl md:text-4xl font-bold text-primary mb-2">People Database</h1>
    <p class="text-text-muted mb-8">
      Individuals connected to the Epstein case. Each profile links to all related articles.
    </p>

    {people.length > 0 ? (
      <div class="space-y-10">
        {categories.map((cat) => {
          const categoryPeople = people.filter((p) => p.data.category === cat);
          return categoryPeople.length > 0 ? (
            <section>
              <h2 class="text-xl font-semibold text-primary mb-4 border-b border-border pb-2">
                {categoryLabels[cat] || cat}
              </h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {categoryPeople.map((person) => (
                  <PersonCard person={person} />
                ))}
              </div>
            </section>
          ) : null;
        })}
      </div>
    ) : (
      <div class="text-center py-16">
        <p class="text-text-muted text-lg">People database is being built.</p>
      </div>
    )}
  </div>
</BaseLayout>
