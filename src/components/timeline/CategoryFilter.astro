---
import { getEraCategoryColor } from '../../utils/timeline-eras';

interface Props {
  categories: string[];
}

const { categories } = Astro.props;

function formatCategory(cat: string): string {
  return cat
    .split('-')
    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
    .join(' ');
}
---

<div class="flex flex-wrap gap-2 mb-8" id="category-filter">
  <button
    class="category-toggle text-xs font-medium px-2.5 py-1 rounded-full border border-border bg-primary text-white transition-all"
    data-category="all"
    data-active="true"
  >
    All
  </button>
  {categories.map((cat) => (
    <button
      class={`category-toggle text-xs font-medium px-2.5 py-1 rounded-full border border-border hover:bg-surface-dark transition-all`}
      data-category={cat}
      data-active="true"
    >
      {formatCategory(cat)}
    </button>
  ))}
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filter = document.getElementById('category-filter');
    if (!filter) return;

    const buttons = filter.querySelectorAll<HTMLButtonElement>('.category-toggle');
    const cards = document.querySelectorAll<HTMLElement>('.timeline-card');

    let activeCategory = 'all';

    buttons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const cat = btn.dataset.category || 'all';
        activeCategory = cat;

        // Update button styles
        buttons.forEach((b) => {
          const isActive = b.dataset.category === cat;
          b.dataset.active = isActive ? 'true' : 'false';
          if (isActive) {
            b.classList.add('bg-primary', 'text-white', 'border-primary');
            b.classList.remove('hover:bg-surface-dark');
          } else {
            b.classList.remove('bg-primary', 'text-white', 'border-primary');
            b.classList.add('hover:bg-surface-dark');
          }
        });

        // Show/hide cards
        cards.forEach((card) => {
          if (cat === 'all' || card.dataset.category === cat) {
            card.classList.remove('hidden');
          } else {
            card.classList.add('hidden');
          }
        });
      });
    });
  });
</script>
