---
import type { CollectionEntry } from 'astro:content';

interface Props {
  person: CollectionEntry<'people'>;
}

const { person } = Astro.props;
const { name, role, category, shortBio, image } = person.data;

const categoryLabels: Record<string, string> = {
  'named-in-documents': 'Named',
  witness: 'Witness',
  associate: 'Associate',
  official: 'Official',
  legal: 'Legal',
  'victim-survivor': 'Survivor',
  other: 'Other',
};

const categoryColors: Record<string, string> = {
  'named-in-documents': 'bg-highlight text-white',
  witness: 'bg-amber-600 text-white',
  associate: 'bg-red-700 text-white',
  official: 'bg-blue-700 text-white',
  legal: 'bg-purple-700 text-white',
  'victim-survivor': 'bg-emerald-700 text-white',
  other: 'bg-gray-600 text-white',
};

const initials = name.split(' ').map((n: string) => n[0]).join('').slice(0, 2);
---

<a
  href={`/people/${person.id}`}
  class="block group no-underline p-4 border border-border hover:border-accent/30 transition-colors"
>
  <div class="flex gap-4">
    {/* Photo or initials */}
    <div class="flex-shrink-0">
      {image ? (
        <img
          src={image}
          alt={name}
          class="w-16 h-16 object-cover rounded-full"
          loading="lazy"
        />
      ) : (
        <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center">
          <span class="text-lg font-bold text-primary/40">{initials}</span>
        </div>
      )}
    </div>

    <div class="flex-1 min-w-0">
      <div class="flex items-start justify-between gap-2 mb-1">
        <h3 class="text-base font-bold text-primary group-hover:text-accent transition-colors">
          {name}
        </h3>
        <span class:list={[
          'text-[10px] font-semibold uppercase tracking-wider px-2 py-0.5 flex-shrink-0',
          categoryColors[category] || 'bg-gray-600 text-white',
        ]}>
          {categoryLabels[category] || category}
        </span>
      </div>

      <p class="text-xs font-semibold text-text-muted uppercase tracking-wider mb-1">{role}</p>
      <p class="text-sm text-text-muted leading-relaxed line-clamp-2">{shortBio}</p>
    </div>
  </div>
</a>
