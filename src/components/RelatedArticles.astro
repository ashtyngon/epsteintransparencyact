---
import { getCollection } from 'astro:content';
import { formatDateShort } from '../utils/slugify';

interface Props {
  personSlug: string;
}

const { personSlug } = Astro.props;

const allArticles = await getCollection('articles', (a) =>
  a.data.status === 'published' && a.data.people.includes(personSlug)
);

const sortedArticles = allArticles.sort(
  (a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime()
);
---

{sortedArticles.length > 0 && (
  <div class="pt-8 border-t-2 border-primary">
    <h2 class="text-sm font-semibold uppercase tracking-wider text-primary mb-4">Related Coverage</h2>
    <div class="space-y-3">
      {sortedArticles.map((article) => (
        <a
          href={`/articles/${article.id}`}
          class="block group no-underline p-4 border border-border hover:border-accent/30 transition-colors"
        >
          <div class="flex items-center gap-2 mb-1">
            <span class="source-badge text-[10px]">{article.data.source}</span>
            <span class="text-xs text-text-muted font-mono">
              {formatDateShort(article.data.publishedAt)}
            </span>
          </div>
          <h3 class="font-serif text-base font-bold text-primary group-hover:text-accent transition-colors leading-snug">
            {article.data.title}
          </h3>
        </a>
      ))}
    </div>
  </div>
)}
