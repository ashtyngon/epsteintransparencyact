---
import { formatDate } from '../utils/slugify';
import type { CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'timeline'>;
}

const { entry } = Astro.props;
const { title, date, category, summary, people } = entry.data;

const categoryColors: Record<string, string> = {
  biography: 'bg-gray-500',
  legal: 'bg-highlight',
  'document-release': 'bg-accent',
  legislation: 'bg-emerald-600',
  investigation: 'bg-amber-500',
  media: 'bg-purple-600',
  other: 'bg-gray-500',
};

const categoryLabels: Record<string, string> = {
  biography: 'Biography',
  legal: 'Legal',
  'document-release': 'Documents',
  legislation: 'Legislation',
  investigation: 'Investigation',
  media: 'Media',
  other: 'Event',
};
---

<div class="relative pl-8 pb-10 border-l-2 border-border last:pb-0 last:border-l-0">
  <!-- Timeline dot -->
  <div class:list={[
    'absolute left-[-5px] top-1.5 w-2 h-2 rounded-full ring-2 ring-surface',
    categoryColors[category] || 'bg-gray-500',
  ]} />

  <!-- Date + category -->
  <div class="flex items-center gap-2 mb-2">
    <time
      datetime={date.toISOString()}
      class="text-xs font-mono text-text-muted"
    >
      {formatDate(date)}
    </time>
    <span class:list={[
      'text-[10px] font-semibold uppercase tracking-wider text-white px-1.5 py-0.5',
      categoryColors[category] || 'bg-gray-500',
    ]}>
      {categoryLabels[category] || category}
    </span>
  </div>

  <!-- Title + summary -->
  <h3 class="font-serif text-lg font-bold text-primary mb-1.5">{title}</h3>
  <p class="text-sm text-text-muted leading-relaxed">{summary}</p>

  <!-- People links -->
  {people.length > 0 && (
    <div class="flex flex-wrap gap-1.5 mt-3">
      {people.map((slug) => (
        <a
          href={`/people/${slug}`}
          class="text-xs font-medium text-primary border border-border px-2 py-0.5 hover:border-accent hover:text-accent transition-colors no-underline"
        >
          {slug.replace(/-/g, ' ').replace(/\b\w/g, (c: string) => c.toUpperCase())}
        </a>
      ))}
    </div>
  )}
</div>
